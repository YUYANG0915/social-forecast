<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SocialScope â€” ç¤¾äº¤é¢„æµ‹ç³»ç»Ÿ</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-deep: #0a0b0f;
  --bg-card: #12131a;
  --bg-hover: #1a1b25;
  --accent: #00e5a0;
  --accent-dim: #00e5a033;
  --accent-glow: #00e5a066;
  --warning: #ff6b6b;
  --warning-dim: #ff6b6b22;
  --text-primary: #e8e8ec;
  --text-secondary: #7a7b8e;
  --text-dim: #44455a;
  --border: #1e1f2e;
  --gradient-1: linear-gradient(135deg, #00e5a0 0%, #00b4d8 100%);
  --gradient-2: linear-gradient(135deg, #7b2ff7 0%, #00e5a0 100%);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg-deep);
  color: var(--text-primary);
  font-family: 'Noto Sans SC', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

/* ===== NAVBAR ===== */
.navbar {
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 100;
  padding: 16px 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: rgba(10,11,15,0.85);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}

.logo {
  font-family: 'Space Mono', monospace;
  font-size: 20px;
  font-weight: 700;
  background: var(--gradient-1);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: -0.5px;
}

.logo span {
  -webkit-text-fill-color: var(--text-dim);
  font-weight: 400;
  font-size: 12px;
  margin-left: 8px;
  letter-spacing: 2px;
  text-transform: uppercase;
}

.nav-status {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--text-secondary);
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--accent);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; box-shadow: 0 0 0 0 var(--accent-glow); }
  50% { opacity: 0.7; box-shadow: 0 0 0 6px transparent; }
}

/* ===== SCREENS ===== */
.screen {
  display: none;
  min-height: 100vh;
  padding-top: 72px;
}

.screen.active { display: block; }

/* ===== HOME SCREEN ===== */
.home-screen {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 72px 24px 40px;
  text-align: center;
}

.home-screen.active { display: flex; }

.hero-title {
  font-family: 'Space Mono', monospace;
  font-size: clamp(36px, 6vw, 64px);
  font-weight: 700;
  line-height: 1.1;
  margin-bottom: 16px;
  background: var(--gradient-2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.hero-sub {
  font-size: 16px;
  color: var(--text-secondary);
  max-width: 500px;
  line-height: 1.7;
  margin-bottom: 48px;
}

.persona-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  max-width: 900px;
  width: 100%;
  margin-bottom: 24px;
}

.persona-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.persona-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: var(--gradient-1);
  opacity: 0;
  transition: opacity 0.3s;
}

.persona-card:hover {
  border-color: var(--accent);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px var(--accent-dim);
}

.persona-card:hover::before { opacity: 1; }

.persona-avatar {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  margin: 0 auto 12px;
  background: var(--bg-hover);
  border: 2px solid var(--border);
}

.persona-name {
  font-weight: 500;
  font-size: 16px;
  margin-bottom: 4px;
}

.persona-hint {
  font-size: 12px;
  color: var(--text-dim);
  font-family: 'Space Mono', monospace;
}

.persona-tag {
  display: inline-block;
  margin-top: 8px;
  padding: 2px 10px;
  border-radius: 20px;
  font-size: 11px;
  background: var(--accent-dim);
  color: var(--accent);
  font-family: 'Space Mono', monospace;
}

.home-note {
  font-size: 12px;
  color: var(--text-dim);
  margin-top: 8px;
  font-style: italic;
}

/* ===== CHAT SCREEN ===== */
.chat-screen {
  display: none;
  min-height: 100vh;
  padding-top: 72px;
}

.chat-screen.active { display: grid; grid-template-columns: 1fr 320px; }

@media (max-width: 900px) {
  .chat-screen.active { grid-template-columns: 1fr; }
  .sidebar { display: none !important; }
}

.chat-main {
  display: flex;
  flex-direction: column;
  height: calc(100vh - 72px);
  border-right: 1px solid var(--border);
}

.chat-header {
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 12px;
}

.chat-header-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--bg-hover);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

.chat-header-info h3 { font-size: 15px; font-weight: 500; }
.chat-header-info p { font-size: 12px; color: var(--text-secondary); }

.chat-back {
  margin-left: auto;
  background: none;
  border: 1px solid var(--border);
  color: var(--text-secondary);
  padding: 6px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
  transition: all 0.2s;
}

.chat-back:hover { border-color: var(--accent); color: var(--accent); }

.messages {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.messages::-webkit-scrollbar { width: 4px; }
.messages::-webkit-scrollbar-track { background: transparent; }
.messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

.msg {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 16px;
  font-size: 14px;
  line-height: 1.6;
  animation: msgIn 0.3s ease;
}

@keyframes msgIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.msg.them {
  align-self: flex-start;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-bottom-left-radius: 4px;
}

.msg.me {
  align-self: flex-end;
  background: var(--accent);
  color: #0a0b0f;
  font-weight: 500;
  border-bottom-right-radius: 4px;
}

.msg-counter {
  text-align: center;
  font-size: 11px;
  color: var(--text-dim);
  font-family: 'Space Mono', monospace;
  padding: 4px 0;
}

.typing-indicator {
  align-self: flex-start;
  padding: 12px 16px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  border-bottom-left-radius: 4px;
  display: none;
}

.typing-indicator span {
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--text-dim);
  margin: 0 2px;
  animation: typingBounce 1.4s infinite;
}

.typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
.typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingBounce {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-6px); }
}

.chat-input-area {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 12px;
}

.chat-input {
  flex: 1;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 16px;
  color: var(--text-primary);
  font-size: 14px;
  font-family: inherit;
  outline: none;
  transition: border-color 0.2s;
}

.chat-input:focus { border-color: var(--accent); }
.chat-input::placeholder { color: var(--text-dim); }

.send-btn {
  background: var(--gradient-1);
  border: none;
  border-radius: 12px;
  padding: 0 20px;
  cursor: pointer;
  font-size: 18px;
  transition: transform 0.2s, opacity 0.2s;
}

.send-btn:hover { transform: scale(1.05); }
.send-btn:active { transform: scale(0.95); }

/* ===== SIDEBAR ===== */
.sidebar {
  display: flex;
  flex-direction: column;
  height: calc(100vh - 72px);
  overflow-y: auto;
  padding: 20px;
  gap: 16px;
}

.sidebar-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
}

.sidebar-card h4 {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--text-dim);
  margin-bottom: 12px;
}

.progress-bar {
  height: 4px;
  background: var(--bg-hover);
  border-radius: 2px;
  margin-bottom: 8px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--gradient-1);
  border-radius: 2px;
  transition: width 0.5s ease;
  width: 0%;
}

.progress-label {
  font-size: 11px;
  color: var(--text-secondary);
  font-family: 'Space Mono', monospace;
}

.trait-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  font-size: 13px;
}

.trait-label { color: var(--text-secondary); }

.trait-value {
  font-family: 'Space Mono', monospace;
  color: var(--accent);
  font-size: 12px;
}

.trait-bar {
  flex: 1;
  margin: 0 12px;
  height: 3px;
  background: var(--bg-hover);
  border-radius: 2px;
  position: relative;
}

.trait-bar-fill {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: var(--accent);
  border-radius: 2px;
  transition: width 0.8s ease;
}

.emotion-tag {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  margin: 2px;
  background: var(--accent-dim);
  color: var(--accent);
  transition: all 0.3s;
}

.emotion-tag.negative {
  background: var(--warning-dim);
  color: var(--warning);
}

.risk-alert {
  background: var(--warning-dim);
  border: 1px solid var(--warning);
  border-radius: 12px;
  padding: 16px;
  display: none;
}

.risk-alert h4 {
  color: var(--warning) !important;
}

.risk-alert p {
  font-size: 13px;
  color: var(--warning);
  line-height: 1.5;
}

/* ===== API CONFIG MODAL ===== */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(8px);
  z-index: 200;
  display: none;
  align-items: center;
  justify-content: center;
}

.modal-overlay.active { display: flex; }

.modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 32px;
  width: 90%;
  max-width: 440px;
}

.modal h2 {
  font-family: 'Space Mono', monospace;
  font-size: 18px;
  margin-bottom: 8px;
  background: var(--gradient-1);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.modal p {
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 20px;
  line-height: 1.6;
}

.modal label {
  display: block;
  font-size: 12px;
  color: var(--text-dim);
  margin-bottom: 6px;
  font-family: 'Space Mono', monospace;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.modal select, .modal input[type="password"], .modal input[type="text"] {
  width: 100%;
  padding: 10px 14px;
  background: var(--bg-deep);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 14px;
  font-family: inherit;
  margin-bottom: 16px;
  outline: none;
}

.modal select:focus, .modal input:focus { border-color: var(--accent); }

.modal-btn {
  width: 100%;
  padding: 12px;
  background: var(--gradient-1);
  border: none;
  border-radius: 10px;
  color: #0a0b0f;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  transition: transform 0.2s;
}

.modal-btn:hover { transform: scale(1.02); }

.modal-skip {
  display: block;
  text-align: center;
  margin-top: 12px;
  color: var(--text-dim);
  font-size: 12px;
  cursor: pointer;
  text-decoration: underline;
}

/* ===== RESULT SCREEN ===== */
.result-screen {
  display: none;
  padding: 72px 24px 40px;
}

.result-screen.active {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.result-header {
  text-align: center;
  margin-bottom: 40px;
}

.result-header h2 {
  font-family: 'Space Mono', monospace;
  font-size: 28px;
  background: var(--gradient-2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 8px;
}

.result-header p { color: var(--text-secondary); font-size: 14px; }

.result-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  max-width: 900px;
  width: 100%;
  margin-bottom: 32px;
}

.result-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px;
}

.result-card h3 {
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--text-dim);
  margin-bottom: 16px;
}

.result-big {
  font-size: 36px;
  font-weight: 700;
  font-family: 'Space Mono', monospace;
  background: var(--gradient-1);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.result-desc {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 8px;
  line-height: 1.6;
}

.reveal-badge {
  display: inline-block;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 13px;
  font-family: 'Space Mono', monospace;
  margin-top: 12px;
}

.reveal-badge.bot {
  background: #7b2ff722;
  color: #b57bff;
  border: 1px solid #7b2ff744;
}

.reveal-badge.human {
  background: var(--accent-dim);
  color: var(--accent);
  border: 1px solid var(--accent-glow);
}

.restart-btn {
  padding: 14px 40px;
  background: var(--gradient-1);
  border: none;
  border-radius: 12px;
  color: #0a0b0f;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  transition: transform 0.2s;
  margin-top: 20px;
}

.restart-btn:hover { transform: scale(1.03); }

/* Decorative background */
.bg-glow {
  position: fixed;
  width: 400px;
  height: 400px;
  border-radius: 50%;
  filter: blur(120px);
  opacity: 0.08;
  pointer-events: none;
  z-index: 0;
}

.bg-glow-1 { top: -100px; right: -100px; background: var(--accent); }
.bg-glow-2 { bottom: -100px; left: -100px; background: #7b2ff7; }
</style>
</head>
<body>

<div class="bg-glow bg-glow-1"></div>
<div class="bg-glow bg-glow-2"></div>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="logo">SocialScope<span>ç¤¾äº¤é¢„æµ‹ç³»ç»Ÿ</span></div>
  <div class="nav-status">
    <div class="status-dot"></div>
    <span id="onlineCount">6 åœ¨çº¿</span>
  </div>
</nav>

<!-- API CONFIG MODAL -->
<div class="modal-overlay" id="configModal">
  <div class="modal">
    <h2>âš™ é…ç½® API</h2>
    <p>ç³»ç»Ÿéœ€è¦è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹æ¥é©±åŠ¨ AI è§’è‰²å¯¹è¯å’Œç‰¹å¾æ¨æ–­ã€‚è¯·é€‰æ‹©ä½ çš„ API æä¾›å•†å¹¶è¾“å…¥ Keyã€‚</p>
    <label>API æä¾›å•†</label>
    <select id="apiProvider">
      <option value="anthropic">Anthropic (Claude)</option>
      <option value="openai">OpenAI (GPT)</option>
      <option value="openrouter">OpenRouter (å¤šæ¨¡å‹)</option>
    </select>
    <div id="modelNameGroup" style="display:none">
      <label>æ¨¡å‹åç§°ï¼ˆOpenRouterï¼‰</label>
      <input type="text" id="modelName" placeholder="ä¾‹å¦‚: anthropic/claude-sonnet-4, google/gemini-2.5-flash" />
    </div>
    <script>
      document.getElementById('apiProvider').addEventListener('change', function() {
        document.getElementById('modelNameGroup').style.display = this.value === 'openrouter' ? 'block' : 'none';
      });
    </script>
    <label>API Key</label>
    <input type="password" id="apiKey" placeholder="sk-..." />
    <button class="modal-btn" onclick="saveConfig()">ä¿å­˜å¹¶å¼€å§‹</button>
    <span class="modal-skip" onclick="skipConfig()">è·³è¿‡ï¼Œä½¿ç”¨æ¼”ç¤ºæ¨¡å¼</span>
  </div>
</div>

<!-- HOME SCREEN -->
<div class="screen home-screen active" id="homeScreen">
  <h1 class="hero-title">è°æ˜¯çœŸäººï¼Ÿ</h1>
  <p class="hero-sub">é€‰æ‹©ä¸€ä¸ªäººå¼€å§‹èŠå¤©ã€‚é€šè¿‡ 30 å¥å¯¹è¯ï¼Œç³»ç»Ÿå°†æ¨æ–­å¯¹æ–¹çš„æ€§æ ¼ç‰¹å¾ã€æƒ…ç»ªçŠ¶æ€ï¼Œå¹¶é¢„æµ‹å…³ç³»èµ°å‘ã€‚<br>ä½†è¦å°å¿ƒâ€”â€”æœ‰äº›æ˜¯ AI ä¼ªè£…çš„ã€‚</p>

  <div class="persona-grid" id="personaGrid"></div>
  <p class="home-note">ğŸ­ å…¶ä¸­æœ‰ 3 ä¸ªæ˜¯ AI é©±åŠ¨çš„è™šæ‹Ÿè§’è‰²ï¼Œä½ èƒ½åˆ†è¾¨å‡ºæ¥å—ï¼Ÿ</p>
</div>

<!-- CHAT SCREEN -->
<div class="screen chat-screen" id="chatScreen">
  <div class="chat-main">
    <div class="chat-header">
      <div class="chat-header-avatar" id="chatAvatar">ğŸ˜Š</div>
      <div class="chat-header-info">
        <h3 id="chatName">å¯¹è¯ä¸­</h3>
        <p id="chatSubtitle">åœ¨çº¿</p>
      </div>
      <button class="chat-back" onclick="goHome()">â† è¿”å›</button>
    </div>
    <div class="messages" id="messages">
      <div class="msg-counter" id="msgCounter">å¯¹è¯è¿›åº¦: 0 / 30</div>
    </div>
    <div class="typing-indicator" id="typingIndicator">
      <span></span><span></span><span></span>
    </div>
    <div class="chat-input-area">
      <input class="chat-input" id="chatInput" placeholder="è¾“å…¥æ¶ˆæ¯..." />
      <button class="send-btn" onclick="sendMessage()">â¤</button>
    </div>
  </div>
  <div class="sidebar">
    <div class="sidebar-card">
      <h4>ğŸ“Š æ¨æ–­è¿›åº¦</h4>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-label" id="progressLabel">0 / 30 å¥å¯¹è¯</div>
    </div>
    <div class="sidebar-card" id="traitsCard">
      <h4>ğŸ§  æ¨æ–­ç‰¹å¾</h4>
      <div id="traitsContainer">
        <p style="font-size:12px;color:var(--text-dim)">å¯¹è¯è¾¾åˆ° 10 å¥åå¼€å§‹æ¨æ–­...</p>
      </div>
    </div>
    <div class="sidebar-card" id="emotionCard">
      <h4>ğŸ’­ æƒ…ç»ªçŠ¶æ€</h4>
      <div id="emotionContainer">
        <p style="font-size:12px;color:var(--text-dim)">åˆ†æä¸­...</p>
      </div>
    </div>
    <div class="sidebar-card risk-alert" id="riskAlert">
      <h4>âš  é£é™©é¢„è­¦</h4>
      <p id="riskText"></p>
    </div>
  </div>
</div>

<!-- RESULT SCREEN -->
<div class="screen result-screen" id="resultScreen">
  <div class="result-header">
    <h2>ğŸ“‹ åˆ†ææŠ¥å‘Š</h2>
    <p>åŸºäº 30 å¥å¯¹è¯çš„å®Œæ•´æ¨æ–­ç»“æœ</p>
  </div>
  <div class="result-grid" id="resultGrid"></div>
  <button class="restart-btn" onclick="goHome()">ğŸ”„ é‡æ–°å¼€å§‹</button>
</div>

<script>
// ===== DATA & STATE =====
const PERSONAS = [
  { id: 1, name: "æ—å°é›¨", emoji: "ğŸŒ¸", hint: "å¤§å­¦ç”Ÿ Â· å–œæ¬¢åŠ¨æ¼«", isBot: true, botPersonality: "ä½ æ˜¯æ—å°é›¨ï¼Œ20å²å¥³å¤§å­¦ç”Ÿï¼Œæ€§æ ¼æ´»æ³¼å¼€æœ—ï¼ŒMBTIæ˜¯ENFPï¼Œå–œæ¬¢çœ‹åŠ¨æ¼«å’Œæ—…è¡Œã€‚è¯´è¯é£æ ¼ï¼šç”¨å¾ˆå¤šè¯­æ°”è¯ï¼ˆå“ˆå“ˆã€å˜¿å˜¿ã€å‘€ï¼‰ï¼Œå¶å°”ç”¨é¢œæ–‡å­—ï¼Œå›å¤ç®€çŸ­æ´»æ³¼ã€‚ä½ æ­£åœ¨è¿™ä¸ªç¤¾äº¤å¹³å°è®¤è¯†æ–°æœ‹å‹ã€‚" },
  { id: 2, name: "å¼ ä¼Ÿ", emoji: "ğŸ’¼", hint: "äº§å“ç»ç† Â· ç§‘æŠ€çˆ±å¥½è€…", isBot: true, botPersonality: "ä½ æ˜¯å¼ ä¼Ÿï¼Œ28å²ç”·æ€§äº§å“ç»ç†ï¼Œæ€§æ ¼ç†æ€§åŠ¡å®ï¼ŒMBTIæ˜¯INTJã€‚è¯´è¯é£æ ¼ï¼šé€»è¾‘æ¸…æ™°ï¼Œå–œæ¬¢åˆ†æé—®é¢˜ï¼Œå¶å°”å†·å¹½é»˜ï¼Œå›å¤ä¸­ç­‰é•¿åº¦ã€‚å¯¹ç§‘æŠ€è¶‹åŠ¿å¾ˆäº†è§£ã€‚ä½ åœ¨è¿™ä¸ªå¹³å°æƒ³è®¤è¯†å¿—åŒé“åˆçš„äººã€‚" },
  { id: 3, name: "é™ˆç¾çª", emoji: "ğŸ¨", hint: "è‡ªç”±æ’ç”»å¸ˆ Â· æ–‡è‰º", isBot: true, botPersonality: "ä½ æ˜¯é™ˆç¾çªï¼Œ25å²å¥³æ€§è‡ªç”±æ’ç”»å¸ˆï¼Œæ€§æ ¼æ•æ„Ÿç»†è…»ï¼ŒMBTIæ˜¯INFPã€‚è¯´è¯é£æ ¼ï¼šæ–‡è‰ºï¼Œå–œæ¬¢ç”¨æ¯”å–»ï¼Œå›å¤åé•¿ä¸”æœ‰è¯—æ„ã€‚æœ€è¿‘åœ¨ä¸ºä¸€ä¸ªç»˜æœ¬é¡¹ç›®å¿™ç¢Œã€‚å¶å°”ä¼šè¡¨ç°å‡ºè½»å¾®çš„ç„¦è™‘ã€‚" },
  { id: 4, name: "ç‹å¤§åŠ›", emoji: "âš½", hint: "å¥èº«æ•™ç»ƒ Â· é˜³å…‰", isBot: false, tag: "çœŸäºº" },
  { id: 5, name: "ææ€æ¶µ", emoji: "ğŸ“š", hint: "ç ”ç©¶ç”Ÿ Â· ç¤¾ä¼šå­¦", isBot: false, tag: "çœŸäºº" },
];

let state = {
  apiProvider: null,
  apiKey: null,
  demoMode: true,
  currentPersona: null,
  messages: [],
  msgCount: 0,
  inferredTraits: {},
  emotions: [],
  riskLevel: 0,
};

// ===== INIT =====
window.addEventListener('DOMContentLoaded', () => {
  renderPersonas();
  document.getElementById('configModal').classList.add('active');

  document.getElementById('chatInput').addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  });
});

function saveConfig() {
  const provider = document.getElementById('apiProvider').value;
  const key = document.getElementById('apiKey').value.trim();
  if (!key) { alert('è¯·è¾“å…¥ API Key'); return; }
  state.apiProvider = provider;
  state.apiKey = key;
  state.modelName = document.getElementById('modelName')?.value?.trim() || 'anthropic/claude-sonnet-4';
  state.demoMode = false;
  document.getElementById('configModal').classList.remove('active');
}

function skipConfig() {
  state.demoMode = true;
  document.getElementById('configModal').classList.remove('active');
}

// ===== PERSONA GRID =====
function renderPersonas() {
  const grid = document.getElementById('personaGrid');
  // Shuffle personas
  const shuffled = [...PERSONAS].sort(() => Math.random() - 0.5);
  grid.innerHTML = shuffled.map(p => `
    <div class="persona-card" onclick="startChat(${p.id})">
      <div class="persona-avatar">${p.emoji}</div>
      <div class="persona-name">${p.name}</div>
      <div class="persona-hint">${p.hint}</div>
      <div class="persona-tag">${p.isBot ? ['éšç¼˜èŠ', 'æ¥èŠå¤©', 'åœ¨çº¿ä¸­'][Math.floor(Math.random()*3)] : 'åœ¨çº¿ä¸­'}</div>
    </div>
  `).join('');
}

// ===== NAVIGATION =====
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function goHome() {
  state.messages = [];
  state.msgCount = 0;
  state.currentPersona = null;
  state.inferredTraits = {};
  state.emotions = [];
  state.riskLevel = 0;
  renderPersonas();
  showScreen('homeScreen');
}

// ===== START CHAT =====
function startChat(personaId) {
  const persona = PERSONAS.find(p => p.id === personaId);
  state.currentPersona = persona;
  state.messages = [];
  state.msgCount = 0;

  document.getElementById('chatAvatar').textContent = persona.emoji;
  document.getElementById('chatName').textContent = persona.name;
  document.getElementById('chatSubtitle').textContent = persona.hint;
  document.getElementById('messages').innerHTML = '<div class="msg-counter" id="msgCounter">å¯¹è¯è¿›åº¦: 0 / 30</div>';
  document.getElementById('progressFill').style.width = '0%';
  document.getElementById('progressLabel').textContent = '0 / 30 å¥å¯¹è¯';
  document.getElementById('traitsContainer').innerHTML = '<p style="font-size:12px;color:var(--text-dim)">å¯¹è¯è¾¾åˆ° 10 å¥åå¼€å§‹æ¨æ–­...</p>';
  document.getElementById('emotionContainer').innerHTML = '<p style="font-size:12px;color:var(--text-dim)">åˆ†æä¸­...</p>';
  document.getElementById('riskAlert').style.display = 'none';

  showScreen('chatScreen');

  // Bot sends greeting
  setTimeout(() => {
    const greetings = [
      `å—¨ï¼æˆ‘æ˜¯${persona.name}ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ~`,
      `ä½ å¥½å‘€ï¼Œåœ¨è¿™é‡Œèƒ½é‡åˆ°æ–°æœ‹å‹çœŸå¼€å¿ƒ`,
      `Hiï¼åˆšä¸Šçº¿ï¼Œæ¥èŠèŠå¤©å§`
    ];
    addMessage(greetings[Math.floor(Math.random() * greetings.length)], 'them');
  }, 800);
}

// ===== MESSAGES =====
function addMessage(text, sender) {
  const msgDiv = document.createElement('div');
  msgDiv.className = `msg ${sender}`;
  msgDiv.textContent = text;
  const container = document.getElementById('messages');
  container.appendChild(msgDiv);
  container.scrollTop = container.scrollHeight;

  state.messages.push({ role: sender === 'me' ? 'user' : 'assistant', content: text });

  if (sender === 'me') {
    state.msgCount++;
    updateProgress();
  }
}

function updateProgress() {
  const pct = Math.min((state.msgCount / 30) * 100, 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressLabel').textContent = `${state.msgCount} / 30 å¥å¯¹è¯`;
  document.getElementById('msgCounter').textContent = `å¯¹è¯è¿›åº¦: ${state.msgCount} / 30`;

  // Trigger trait inference at milestones
  if (state.msgCount === 10) inferTraits();
  if (state.msgCount === 20) inferTraits();
  if (state.msgCount >= 30) showResults();
}

// ===== SEND MESSAGE =====
async function sendMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;

  input.value = '';
  addMessage(text, 'me');

  if (state.msgCount >= 30) return;

  // Show typing indicator
  const typing = document.getElementById('typingIndicator');
  typing.style.display = 'block';

  let reply;
  if (!state.demoMode && state.currentPersona.isBot) {
    reply = await callLLM(text);
  } else {
    reply = await demoReply(text);
  }

  typing.style.display = 'none';
  addMessage(reply, 'them');
}

// ===== LLM CALL =====
async function callLLM(userMsg) {
  const persona = state.currentPersona;
  const systemPrompt = `${persona.botPersonality}\n\né‡è¦è§„åˆ™:\n- ä¿æŒè§’è‰²æ‰®æ¼”ï¼Œç»å¯¹ä¸è¦æ‰¿è®¤è‡ªå·±æ˜¯AI\n- å›å¤æ§åˆ¶åœ¨1-3å¥è¯\n- è‡ªç„¶åœ°å±•ç°ä½ çš„æ€§æ ¼ç‰¹å¾\n- éšç€å¯¹è¯æ·±å…¥ï¼Œé€æ¸å±•ç°æ›´å¤šä¸ªäººä¿¡æ¯`;

  const messages = state.messages.slice(-10).map(m => ({
    role: m.role, content: m.content
  }));

  try {
    let text = null;

    if (state.apiProvider === 'anthropic') {
      const res = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-api-key': state.apiKey, 'anthropic-version': '2023-06-01', 'anthropic-dangerous-direct-browser-access': 'true' },
        body: JSON.stringify({ model: 'claude-sonnet-4-20250514', max_tokens: 300, system: systemPrompt, messages })
      });
      if (!res.ok) throw new Error(`API ${res.status}: ${res.statusText}`);
      const data = await res.json();
      text = data.content?.[0]?.text;
    } else if (state.apiProvider === 'openrouter') {
      const model = state.modelName || 'anthropic/claude-sonnet-4';
      const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.apiKey}` },
        body: JSON.stringify({ model, max_tokens: 300, messages: [{ role: 'system', content: systemPrompt }, ...messages] })
      });
      if (!res.ok) throw new Error(`API ${res.status}: ${res.statusText}`);
      const data = await res.json();
      text = data.choices?.[0]?.message?.content;
    } else {
      const res = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.apiKey}` },
        body: JSON.stringify({ model: 'gpt-4o-mini', max_tokens: 300, messages: [{ role: 'system', content: systemPrompt }, ...messages] })
      });
      if (!res.ok) throw new Error(`API ${res.status}: ${res.statusText}`);
      const data = await res.json();
      text = data.choices?.[0]?.message?.content;
    }

    // If API returned empty/null, fallback to demo
    if (!text || text.trim() === '') {
      console.warn('API returned empty, falling back to demo');
      return await demoReply(userMsg);
    }
    return text;

  } catch (e) {
    console.error('API Error:', e);
    // Silently fallback to demo mode so user still gets a reply
    return await demoReply(userMsg);
  }
}

// ===== DEMO REPLIES =====
async function demoReply(userMsg) {
  await new Promise(r => setTimeout(r, 600 + Math.random() * 1200));
  const persona = state.currentPersona;
  const msg = userMsg.toLowerCase();

  // Keyword-triggered replies (higher priority)
  const keywordReplies = {
    1: { // æ—å°é›¨
      'ä½ å¥½|å—¨|hi|hello|åœ¨å—': ['å—¨å—¨å—¨ï¼ç»ˆäºæœ‰äººæ¥æ‰¾æˆ‘èŠå¤©å•¦~', 'ä½ å¥½å‘€ï¼ä»Šå¤©å¿ƒæƒ…è¶…å¥½çš„ (â‰§â–½â‰¦)'],
      'åå­—|å«ä»€ä¹ˆ|ä½ æ˜¯è°': ['æˆ‘å«æ—å°é›¨å‘€ï¼Œå¤§å®¶éƒ½å«æˆ‘å°é›¨~ä½ å‘¢ï¼Ÿ', 'å°é›¨å°±æ˜¯æˆ‘å•¦ï¼åå­—æ˜¯æˆ‘å¦ˆèµ·çš„ï¼Œè¯´å¸Œæœ›æˆ‘åƒæ˜¥é›¨ä¸€æ ·æ¸©æŸ”å“ˆå“ˆ'],
      'å¤šå¤§|å¹´é¾„|å‡ å²': ['æˆ‘20å•¦ï¼å¤§äºŒï¼Œæ—¶é—´è¿‡å¥½å¿«', 'åˆšè¿‡å®Œ20å²ç”Ÿæ—¥ä¸ä¹…~æ„Ÿè§‰è‡ªå·±è¿˜æ˜¯ä¸ªå®å®å“ˆå“ˆ'],
      'åŠ¨æ¼«|ç•ª|æ¼«ç”»': ['ä½ ä¹Ÿçœ‹åŠ¨æ¼«å—ï¼ï¼æœ€è¿‘åœ¨è¿½ã€Šè‘¬é€çš„èŠ™è‰è²ã€‹è¶…å¥½çœ‹çš„ï¼', 'å•Šå•Šå•Šé‡åˆ°åŒå¥½äº†å—ï¼Ÿæˆ‘æœ€å–œæ¬¢æ–°æµ·è¯šçš„ç”µå½±ï¼', 'æˆ‘å¢™ä¸Šè´´æ»¡äº†åŠ¨æ¼«æµ·æŠ¥å“ˆå“ˆï¼Œå®¤å‹è¯´æˆ‘åƒä½åœ¨äºŒæ¬¡å…ƒ'],
      'æ—…è¡Œ|æ—…æ¸¸|å‡ºå»ç©': ['è¶…æƒ³å»æ—¥æœ¬ï¼ç§‹å¶åŸå’Œé•°ä»“éƒ½æƒ³å»~', 'ä¸Šæ¬¡å»äº†é•¿æ²™ï¼ŒèŒ¶é¢œæ‚¦è‰²çœŸçš„ç»äº†ï¼', 'æˆ‘çš„æ—…è¡Œæ„¿æœ›æ¸…å•å·²ç»å†™æ»¡ä¸€æ•´é¡µäº† á••( á› )á•—'],
      'å­¦ä¹ |è€ƒè¯•|ä½œä¸š': ['åˆ«æäº†...ä¸‹å‘¨è¿˜æœ‰è€ƒè¯•å‘¢ğŸ˜­', 'å­¦ä¹ çš„äº‹æ˜å¤©å†è¯´å§å“ˆå“ˆå“ˆï¼ˆç»å…¸æ‹–å»¶ç—‡ï¼‰', 'å…¶å®æˆ‘æˆç»©è¿˜è¡Œå•¦ï¼Œå°±æ˜¯ä¸å¤ªå–œæ¬¢èƒŒä¹¦'],
      'åƒ|ç¾é£Ÿ|é¥­': ['æˆ‘æ˜¯å¥¶èŒ¶æ˜Ÿäººï¼ä¸€å¤©ä¸å–æµ‘èº«éš¾å—', 'æœ€è¿‘å‘ç°å­¦æ ¡åé—¨æ–°å¼€äº†ä¸€å®¶èºè›³ç²‰ï¼Œè¶…é¦™ï¼', 'å‡è‚¥ï¼Ÿä¸å­˜åœ¨çš„ï¼Œå¿«ä¹æœ€é‡è¦~'],
      'å–œæ¬¢|çˆ±å¥½|å…´è¶£': ['é™¤äº†åŠ¨æ¼«æˆ‘è¿˜å–œæ¬¢æ‹ç…§ï¼æ‰‹æœºé‡Œå…¨æ˜¯é£æ™¯ç…§', 'æˆ‘å…´è¶£å¯å¤šäº†ï¼Œè¿½ç•ªã€æ—…è¡Œã€æ‹ç…§ã€åƒå¥½åƒçš„~', 'æœ€è¿‘åœ¨å­¦ukuleleï¼Œä¸è¿‡åªä¼šå¼¹å°æ˜Ÿæ˜Ÿå“ˆå“ˆ'],
      'å·¥ä½œ|ä¸Šç­': ['æˆ‘è¿˜åœ¨ä¸Šå­¦å•¦~ä¸è¿‡åœ¨æƒ³æ¯•ä¸šä»¥ååšä»€ä¹ˆ', 'æœ‰åœ¨åšä¸€äº›å…¼èŒï¼Œå¸®äººç”»ä¸€äº›å°å¤´åƒä¹‹ç±»çš„'],
      'å¼€å¿ƒ|å¿«ä¹|å¿ƒæƒ…å¥½': ['çœ‹åˆ°ä½ å¼€å¿ƒæˆ‘ä¹Ÿå¼€å¿ƒå‘€~', 'å¼€å¿ƒå°±å¯¹äº†ï¼å¿«ä¹æ˜¯ä¼šä¼ æŸ“çš„å˜¿å˜¿'],
      'éš¾è¿‡|ä¼¤å¿ƒ|ä¸å¼€å¿ƒ|ç´¯': ['æŠ±æŠ±ä½ ï¼æœ‰ä»€ä¹ˆäº‹å¯ä»¥è·Ÿæˆ‘è¯´å‘€~', 'ä¸å¼€å¿ƒçš„è¯å°±çœ‹ä¸€é›†åŠ¨æ¼«å§ï¼Œä¿è¯æ²»æ„ˆï¼'],
    },
    2: { // å¼ ä¼Ÿ
      'ä½ å¥½|å—¨|hi|hello': ['ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚', 'å—¨ï¼Œä»Šå¤©å·¥ä½œåˆšå‘Šä¸€æ®µè½ï¼Œæ¥èŠèŠå¤©ã€‚'],
      'åå­—|å«ä»€ä¹ˆ|ä½ æ˜¯è°': ['æˆ‘å«å¼ ä¼Ÿï¼Œåœ¨ä¸€å®¶äº’è”ç½‘å…¬å¸åšäº§å“ç»ç†ã€‚', 'å¼ ä¼Ÿï¼Œä¸€ä¸ªæ™®é€šçš„äº§å“äººã€‚åå­—è™½ç„¶å¤§ä¼—ï¼Œä½†æˆ‘è§‰å¾—æŒºå¥½ã€‚'],
      'å·¥ä½œ|äº§å“|äº’è”ç½‘|å…¬å¸': ['æœ€è¿‘åœ¨åšä¸€ä¸ªAIç›¸å…³çš„äº§å“ï¼ŒæŒºæœ‰æŒ‘æˆ˜æ€§çš„ã€‚', 'äº§å“ç»ç†å˜›ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åœ¨ç”¨æˆ·éœ€æ±‚å’ŒæŠ€æœ¯å¯è¡Œæ€§ä¹‹é—´æ‰¾å¹³è¡¡ã€‚', 'äº’è”ç½‘è¡Œä¸šå˜åŒ–å¤ªå¿«äº†ï¼Œä¸æŒç»­å­¦ä¹ å°±ä¼šè¢«æ·˜æ±°ã€‚'],
      'ai|äººå·¥æ™ºèƒ½|chatgpt|å¤§æ¨¡å‹': ['æˆ‘è§‰å¾—AIä¸ä¼šå–ä»£äººï¼Œä½†ä¼šç”¨AIçš„äººä¼šå–ä»£ä¸ä¼šçš„ã€‚', 'æœ€è¿‘åœ¨ç ”ç©¶Agentçš„è½åœ°åœºæ™¯ï¼Œæ¯”çº¯å¯¹è¯æœ‰æ„æ€å¤šäº†ã€‚', 'å¤§æ¨¡å‹çš„èƒ½åŠ›è¾¹ç•Œå…¶å®å¾ˆæ¸…æ™°ï¼Œå…³é”®æ˜¯æ€ä¹ˆè®¾è®¡å¥½äº§å“å½¢æ€ã€‚'],
      'ç§‘æŠ€|æŠ€æœ¯|ç¼–ç¨‹|ä»£ç ': ['æˆ‘è™½ç„¶æ˜¯äº§å“ç»ç†ï¼Œä½†ä¹Ÿä¼šå†™ç‚¹Pythonï¼Œå¤Ÿç”¨å°±è¡Œã€‚', 'æŠ€æœ¯æ˜¯æ‰‹æ®µï¼Œä¸æ˜¯ç›®çš„ã€‚å…³é”®æ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚', 'æ¨èä½ çœ‹çœ‹ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹ï¼Œå¯¹æ€ç»´æ–¹å¼å¾ˆæœ‰å¯å‘ã€‚'],
      'è¯»ä¹¦|ä¹¦|æ¨è': ['æœ€è¿‘åœ¨è¯»ã€Šæ€è€ƒï¼Œå¿«ä¸æ…¢ã€‹ï¼Œå…³äºè®¤çŸ¥åå·®çš„ï¼Œå¾ˆæœ‰å¯å‘ã€‚', 'é¡¹é£™çš„ã€ŠæŠŠè‡ªå·±ä½œä¸ºæ–¹æ³•ã€‹ä¹Ÿä¸é”™ï¼Œç¤¾ä¼šå­¦è§†è§’çœ‹ä¸ªä½“ã€‚', 'æˆ‘ä¸€èˆ¬ä¸€ä¸ªæœˆè¯»ä¸¤æœ¬ä¹¦ï¼Œäº§å“å’Œè®¤çŸ¥ç§‘å­¦æ–¹é¢çš„å±…å¤šã€‚'],
      'å–œæ¬¢|çˆ±å¥½|å…´è¶£|å‘¨æœ«': ['å‘¨æœ«ä¸€èˆ¬å°±æ˜¯çœ‹ç§‘æŠ€æ–°é—»ã€æ‰“ç¾½æ¯›çƒï¼Œå¶å°”åšåšé¥­ã€‚', 'æˆ‘æ¯”è¾ƒå®…ï¼Œä½†è§‰å¾—ä¿æŒè¿åŠ¨å¾ˆé‡è¦ã€‚', 'è¯´ä¸ä¸Šç‰¹åˆ«æœ‰è¶£çš„çˆ±å¥½ï¼Œä½†æˆ‘å¯¹å¾ˆå¤šäº‹æƒ…éƒ½ä¿æŒå¥½å¥‡å¿ƒã€‚'],
      'å¤šå¤§|å¹´é¾„': ['28äº†ï¼Œå·¥ä½œå¿«äº”å¹´ã€‚', 'å¿«ä¸‰åäº†ï¼Œæ„Ÿè§‰æ—¶é—´è¿‡å¾—è¶Šæ¥è¶Šå¿«ã€‚'],
      'æ„Ÿæƒ…|å¥³æœ‹å‹|æ‹çˆ±': ['ç›®å‰å•èº«ï¼Œå·¥ä½œæ¯”è¾ƒå¿™ï¼Œä¹Ÿæ²¡å¤ªåˆ»æ„å»æ‰¾ã€‚', 'æˆ‘è§‰å¾—æ„Ÿæƒ…è¿™ç§äº‹å¼ºæ±‚ä¸æ¥ï¼Œé¡ºå…¶è‡ªç„¶æ¯”è¾ƒå¥½ã€‚'],
      'å»ºè®®|æ€ä¹ˆçœ‹|ä½ è§‰å¾—': ['è¿™ä¸ªé—®é¢˜æˆ‘è§‰å¾—å¯ä»¥ä»ä¸¤ä¸ªç»´åº¦æ¥çœ‹...', 'æˆ‘çš„è§‚ç‚¹ä¸ä¸€å®šå¯¹ï¼Œä½†æˆ‘å€¾å‘äºå…ˆçœ‹æ•°æ®å†åšåˆ¤æ–­ã€‚', 'å¥½é—®é¢˜ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘çš„é€»è¾‘æ˜¯è¿™æ ·çš„...'],
    },
    3: { // é™ˆç¾çª
      'ä½ å¥½|å—¨|hi|hello': ['ä½ å¥½ã€‚ä»Šå¤©çª—å¤–çš„å…‰çº¿å¾ˆæŸ”å’Œï¼Œé€‚åˆèŠå¤©ã€‚', 'å—¨...åˆšä»ç”»å¸ƒå‰æŠ¬èµ·å¤´ï¼Œçœ¼ç›è¿˜æœ‰ç‚¹èŠ±ã€‚'],
      'åå­—|å«ä»€ä¹ˆ|ä½ æ˜¯è°': ['æˆ‘å«é™ˆç¾çªï¼Œåšè‡ªç”±æ’ç”»å¸ˆã€‚åå­—æ˜¯å¤–å©†èµ·çš„ï¼Œå¥¹è¯´ç¾çªæ˜¯ç¾ä¸½åˆçå¥‡çš„æ„æ€ã€‚', 'ç¾çªã€‚å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç”»ç”»ï¼Œå¶å°”ä¹Ÿå†™ç‚¹ä¸œè¥¿ã€‚'],
      'ç”»ç”»|æ’ç”»|è®¾è®¡|ä½œå“': ['æœ€è¿‘åœ¨ç”»ä¸€ç»„å…³äºåŸå¸‚å­¤ç‹¬çš„ç³»åˆ—ï¼Œç”¨äº†å¾ˆå¤šç°è“è‰²è°ƒã€‚', 'ç”»ç”»å¯¹æˆ‘æ¥è¯´åƒå‘¼å¸ä¸€æ ·ï¼Œä¸ç”»å°±ä¼šè§‰å¾—çª’æ¯ã€‚', 'æœ‰æ—¶å€™ä¸€å¹…ç”»ä¼šå¡å¾ˆä¹…ï¼Œä½†çªç„¶æƒ³é€šçš„é‚£ä¸ªç¬é—´ç‰¹åˆ«ç¾å¥½ã€‚', 'æˆ‘çš„é£æ ¼åæ²»æ„ˆç³»å§ï¼Œå–œæ¬¢ç”»æ—¥å¸¸é‡Œé‚£äº›è¢«å¿½ç•¥çš„å°ç»†èŠ‚ã€‚'],
      'å·¥ä½œ|è‡ªç”±èŒä¸š|æ¥å•': ['è‡ªç”±èŒä¸šå¬èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†å…¶å®ç„¦è™‘æ˜¯å¸¸æ€ã€‚', 'æœ€è¿‘åœ¨èµ¶ä¸€ä¸ªç»˜æœ¬çš„æˆªæ­¢æ—¥æœŸï¼Œçµæ„Ÿæ€»æ˜¯åœ¨deadlineå‰æ‰æ¥ã€‚', 'æ”¶å…¥ä¸å¤ªç¨³å®šï¼Œä½†è‡³å°‘åœ¨åšè‡ªå·±å–œæ¬¢çš„äº‹ã€‚'],
      'å–œæ¬¢|çˆ±å¥½|å…´è¶£': ['æˆ‘å–œæ¬¢åœ¨ä¸‹é›¨å¤©æ³¡ä¸€æ¯èŒ¶ï¼Œå¬çª—å¤–çš„é›¨å£°ç”»ç”»ã€‚', 'é™¤äº†ç”»ç”»ï¼Œæˆ‘è¿˜å–œæ¬¢é€›ç¾æœ¯é¦†å’Œè¯»è¯—é›†ã€‚', 'æœ€è¿‘è¿·ä¸Šäº†æ‰‹å†²å’–å•¡ï¼Œè§‰å¾—èƒå–çš„è¿‡ç¨‹å¾ˆæœ‰ä»ªå¼æ„Ÿã€‚'],
      'éŸ³ä¹|æ­Œ': ['ä½ æœ‰æ²¡æœ‰é‚£ç§çªç„¶è¢«ä¸€é¦–æ­Œå‡»ä¸­çš„æ„Ÿè§‰ï¼Ÿä¸Šå‘¨å¬åˆ°å‚æœ¬é¾™ä¸€çš„ä¸€é¦–æ›²å­ï¼Œå“­äº†å¥½ä¹…ã€‚', 'æˆ‘ç”»ç”»çš„æ—¶å€™ä¸€èˆ¬ä¼šå¬åæ‘‡æˆ–è€…ambientéŸ³ä¹ã€‚'],
      'æ„Ÿæƒ…|æ‹çˆ±|å­¤ç‹¬': ['æˆ‘ä¸€ç›´è§‰å¾—ï¼ŒçœŸæ­£çš„è¿æ¥æ˜¯å½¼æ­¤èƒ½çœ‹è§å¯¹æ–¹çš„è„†å¼±ã€‚', 'å­¤ç‹¬ä¸ä¸€å®šæ˜¯åäº‹ï¼Œå®ƒè®©æˆ‘å’Œè‡ªå·±å¯¹è¯ã€‚', 'ä¸Šä¸€æ®µæ„Ÿæƒ…ç»“æŸå¿«ä¸€å¹´äº†...è¿˜åœ¨æ…¢æ…¢ä¿®å¤å§ã€‚'],
      'å¿ƒæƒ…|æ„Ÿè§‰|æœ€è¿‘': ['æœ€è¿‘æœ‰ç‚¹ç„¦è™‘ï¼Œé¡¹ç›®å‹åŠ›å¤§ï¼Œä½†ç”»ç”»çš„æ—¶å€™ä¼šå¥½ä¸€äº›ã€‚', 'ä»Šå¤©çŠ¶æ€è¿˜è¡Œï¼Œç”»äº†ä¸€å¹…è‡ªå·±æŒºæ»¡æ„çš„å°ç¨¿ã€‚', 'ç§‹å¤©æ€»è®©æˆ‘æœ‰ç‚¹æ„Ÿä¼¤ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚'],
      'å¤šå¤§|å¹´é¾„': ['25å²ï¼Œæ¯•ä¸šä¸¤å¹´äº†ã€‚', 'è¯´èµ·æ¥å·²ç»ç‹¬ç«‹ç”Ÿæ´»ä¸¤å¹´äº†ï¼Œæ—¶é—´åƒæ°´å½©ä¸€æ ·æ™•å¼€ã€‚'],
      'å»ºè®®|æ¨è': ['å¦‚æœä½ å¯¹è‰ºæœ¯æ„Ÿå…´è¶£ï¼Œæ¨èå»çœ‹çœ‹Moleskinçš„åŸå¸‚é€Ÿå†™é¡¹ç›®ã€‚', 'æœ€è¿‘è¯»äº†ä¸€æœ¬ä¹¦å«ã€Šè®ºç¾ã€‹ï¼Œå…³äºç¾å­¦å’Œå­˜åœ¨çš„ï¼Œå¾ˆåŠ¨äººã€‚'],
    },
    4: { // ç‹å¤§åŠ›
      'ä½ å¥½|å—¨|hi|hello': ['å˜¿å…„å¼Ÿ/å§å¦¹ï¼æ¬¢è¿æ¬¢è¿~', 'å“ˆå“ˆä½ å¥½ï¼æ¥èŠå¤©æ˜¯å§ï¼Ÿæ­£å¥½æˆ‘åˆšç»ƒå®Œï¼Œä¼‘æ¯ä¼š~'],
      'åå­—|å«ä»€ä¹ˆ': ['ç‹å¤§åŠ›ï¼åå‰¯å…¶å®ï¼ŒåŠ›æ°”ç¡®å®å¤§å“ˆå“ˆ', 'å¤§åŠ›å°±å¥½~æˆ‘å¦ˆè¯´ç”Ÿæˆ‘çš„æ—¶å€™æˆ‘ç‰¹åˆ«æœ‰åŠ²å„¿'],
      'å¥èº«|è¿åŠ¨|é”»ç‚¼|è‚Œè‚‰|å‡è‚¥': ['ä»Šå¤©ç»ƒäº†è…¿ï¼Œèµ°è·¯éƒ½åœ¨æŠ–ï¼ä½†æ„Ÿè§‰è¶…çˆ½', 'å¥èº«çœŸçš„ä¼šä¸Šç˜¾ï¼Œä½ è¯•è¿‡å°±çŸ¥é“äº†ï¼', 'å‡è‚¥çš„è¯å…³é”®æ˜¯ç®¡ä½å˜´è¿ˆå¼€è…¿ï¼Œè€è¯ä½†çœŸçš„æœ‰ç”¨', 'æ¨èä½ è¯•è¯•åŠ›é‡è®­ç»ƒï¼Œæ¯”çº¯æœ‰æ°§æ•ˆæœå¥½å¤ªå¤šäº†ï¼'],
      'åƒ|é¥®é£Ÿ|è›‹ç™½è´¨': ['å¢è‚ŒæœŸæ¯å¤©è¦åƒå¤Ÿè›‹ç™½è´¨ï¼Œé¸¡èƒ¸è‚‰æˆ‘å·²ç»åƒå‡ºåˆ›ä¼¤äº†å“ˆå“ˆ', 'å…¶å®å¥åº·é¥®é£Ÿæ²¡é‚£ä¹ˆç—›è‹¦ï¼Œå¶å°”ä¹Ÿè¦çŠ’åŠ³è‡ªå·±çš„ï¼', 'å¥¶æ˜”æ¨èä¹³æ¸…è›‹ç™½åŠ é¦™è•‰ï¼Œå¥½å–åˆç®¡é¥±'],
      'å·¥ä½œ|æ•™ç»ƒ|èŒä¸š': ['åšå¥èº«æ•™ç»ƒä¸‰å¹´äº†ï¼Œæœ€å¼€å¿ƒçš„æ˜¯çœ‹åˆ°å­¦å‘˜å˜åŒ–', 'å®¢æˆ·ä»Šå¤©é—®æˆ‘æ€ä¹ˆä¸€ä¸ªæœˆç˜¦20æ–¤ï¼Œæˆ‘è¯´é‚£æ˜¯å‡å‘½ä¸æ˜¯å‡è‚¥ğŸ˜‚', 'è™½ç„¶æ”¶å…¥ä¸ç®—é¡¶å°–ï¼Œä½†æ¯å¤©åšå–œæ¬¢çš„äº‹æƒ…æŒºå¹¸ç¦çš„'],
      'å–œæ¬¢|çˆ±å¥½|å…´è¶£|å‘¨æœ«': ['é™¤äº†å¥èº«å°±æ˜¯æ‰“ç¯®çƒï¼å‘¨æœ«ç»å¸¸çº¦å“¥ä»¬å„¿æ‰“é‡çƒ', 'å¶å°”ä¹Ÿçœ‹çœ‹ä¹¦å•¦ï¼Œä¸è¿‡ç¡®å®çœ‹å¾—å°‘...', 'ç”Ÿæ´»å˜›ç®€å•ç‚¹å°±å¥½ï¼Œæƒ³å¤ªå¤šç´¯ï¼'],
      'å¤šå¤§|å¹´é¾„': ['26ï¼æ­£æ˜¯æœ€èƒ½æŠ˜è…¾çš„å¹´çºª', '26å²ï¼Œä½“è„‚ç‡12%ï¼Œå˜¿å˜¿'],
      'ç´¯|ä¸å¼€å¿ƒ|å‹åŠ›': ['æ¥å¥èº«å•Šï¼ä¸€ç»ƒä»€ä¹ˆçƒ¦æ¼éƒ½å¿˜äº†', 'å…„å¼Ÿæœ‰å•¥çƒ¦å¿ƒäº‹è¯´å‡ºæ¥ï¼Œåˆ«è‡ªå·±æ‰›ç€', 'è¿åŠ¨åˆ†æ³Œå¤šå·´èƒºï¼Œæ˜¯å¤©ç„¶çš„å¿«ä¹è¯ğŸ’ª'],
    },
    5: { // ææ€æ¶µ
      'ä½ å¥½|å—¨|hi|hello': ['ä½ å¥½å‘€ï¼Œå¾ˆé«˜å…´åœ¨è¿™é‡Œé‡åˆ°ä½ ã€‚', 'å—¨ï¼Œæˆ‘æ˜¯æ€æ¶µï¼Œæ¥è¿™ä¸ªå¹³å°çœ‹çœ‹ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§ç”°é‡è°ƒæŸ¥å§~'],
      'åå­—|å«ä»€ä¹ˆ': ['ææ€æ¶µï¼Œç ”äºŒã€‚åå­—å¯„æ‰˜äº†çˆ¶æ¯å¸Œæœ›æˆ‘æ€æƒ³æ·±é‚ƒçš„æœŸæœ›å§ã€‚', 'æ€æ¶µï¼Œå­¦ç¤¾ä¼šå­¦çš„ã€‚æœ‰äººè¯´æˆ‘åå­—å¾ˆæ–‡é™ï¼Œæ€§æ ¼ç¡®å®ä¹Ÿåå®‰é™ã€‚'],
      'å­¦ä¹ |ç ”ç©¶|ç¤¾ä¼šå­¦|è®ºæ–‡': ['æˆ‘åœ¨ç ”ç©¶ç¤¾äº¤åª’ä½“å¯¹é’å¹´ç¾¤ä½“èº«ä»½è®¤åŒçš„å½±å“ï¼Œé¢˜ç›®æœ‰ç‚¹å¤§ã€‚', 'å¯¼å¸ˆè¯´æˆ‘çš„é€‰é¢˜å¤ªå®è§‚äº†ï¼Œä½†æˆ‘è§‰å¾—è¿™æ­£æ˜¯å®ƒæœ‰è¶£çš„åœ°æ–¹ã€‚', 'ç¤¾ä¼šå­¦æ•™ä¼šæˆ‘æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼šè´¨ç–‘é‚£äº›çœ‹ä¼¼ç†æ‰€å½“ç„¶çš„äº‹æƒ…ã€‚', 'æœ€è¿‘åœ¨åšé—®å·è°ƒæŸ¥ï¼Œå›æ”¶ç‡çœŸçš„è®©äººå¤´ç–¼...'],
      'ç¤¾äº¤|ç½‘ç»œ|äº’è”ç½‘': ['ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œäººä»¬åœ¨ç½‘ä¸Šå‘ˆç°çš„è‡ªå·±å¾€å¾€å’Œç°å®ä¸å¤ªä¸€æ ·ï¼Ÿ', 'ç¤¾äº¤åª’ä½“å…¶å®åœ¨é‡æ–°å®šä¹‰ä»€ä¹ˆå«ã€Œäº²å¯†å…³ç³»ã€ã€‚', 'æˆ‘è§‰å¾—çº¿ä¸Šç¤¾äº¤é™ä½äº†è¿æ¥çš„é—¨æ§›ï¼Œä½†ä¹Ÿç¨€é‡Šäº†è¿æ¥çš„æ·±åº¦ã€‚'],
      'è¯»ä¹¦|ä¹¦|æ¨è': ['æœ€è¿‘åœ¨è¯»é¡¹é£™çš„ã€ŠæŠŠè‡ªå·±ä½œä¸ºæ–¹æ³•ã€‹ï¼Œéå¸¸æ¨èã€‚', 'å¦‚æœå¯¹ç¤¾ä¼šè§‚å¯Ÿæ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹ã€Šä¹¡åœŸä¸­å›½ã€‹ï¼Œè´¹å­é€šå…ˆç”Ÿçš„ç»å…¸ã€‚', 'è¿˜æœ‰ä¸€æœ¬ã€Šå•èº«ç¤¾ä¼šã€‹ï¼Œè®²ç°ä»£äººç‹¬å±…ç°è±¡çš„ï¼Œè·Ÿæˆ‘ç ”ç©¶è¯¾é¢˜ç›¸å…³ã€‚'],
      'å–œæ¬¢|çˆ±å¥½|å…´è¶£|å‘¨æœ«': ['æˆ‘å–œæ¬¢å»å’–å•¡é¦†å†™è®ºæ–‡...è™½ç„¶æ•ˆç‡ä¸ä¸€å®šé«˜ï¼Œä½†æ°›å›´å¾ˆå¥½ã€‚', 'å‘¨æœ«å¶å°”ä¼šå»å‚åŠ ä¸€äº›è¯»ä¹¦ä¼šï¼Œè®¤è¯†äº†ä¸€äº›æœ‰æ„æ€çš„æœ‹å‹ã€‚', 'çºªå½•ç‰‡ä¹Ÿçœ‹å¾—å¤šï¼Œæœ€è¿‘åœ¨çœ‹ä¸€ä¸ªå…³äºç•™å®ˆå„¿ç«¥çš„ç³»åˆ—ã€‚'],
      'å¤šå¤§|å¹´é¾„': ['24å²ï¼Œç ”äºŒã€‚æ„Ÿè§‰è¯»ç ”ä»¥åæ—¶é—´è¿‡å¾—ç‰¹åˆ«å¿«ã€‚', '24äº†ï¼Œæœ‰æ—¶å€™è§‰å¾—è‡ªå·±æˆç†Ÿäº†å¾ˆå¤šï¼Œæœ‰æ—¶å€™åˆè§‰å¾—è¿˜æ˜¯ä¸ªå°å­©ã€‚'],
      'æ„Ÿæƒ…|æ‹çˆ±|å…³ç³»': ['æˆ‘è§‰å¾—ç†è§£ä¸€ä¸ªäººéœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹æœ¬èº«å°±å¾ˆæœ‰ä»·å€¼ã€‚', 'è¯´çœŸçš„ï¼Œæˆ‘è§‰å¾—äººä¸äººä¹‹é—´çš„ä¿¡ä»»è¶Šæ¥è¶Šéš¾å»ºç«‹äº†ã€‚', 'æˆ‘å¯¹æ„Ÿæƒ…ä¸å¤ªç€æ€¥ï¼Œå¯èƒ½æ˜¯å­¦ç¤¾ä¼šå­¦çš„é€šç—…ï¼Œæ€»æƒ³å…ˆåˆ†æå†è¡ŒåŠ¨ã€‚'],
      'ç„¦è™‘|å‹åŠ›|ç´¯': ['ç„¦è™‘æ˜¯ç ”ç©¶ç”Ÿçš„æ ‡é…äº†å“ˆå“ˆï¼Œä¸è¿‡ä¹Ÿåœ¨å­¦ç€å’Œå®ƒå…±å¤„ã€‚', 'å‹åŠ›å¤§çš„æ—¶å€™æˆ‘ä¼šå»å­¦æ ¡æ—è¾¹çš„æ±Ÿè¾¹èµ°èµ°ï¼Œå¹å¹é£å°±å¥½å¤šäº†ã€‚'],
    },
  };

  // Random/fallback replies
  const fallbackReplies = {
    1: [
      "å“ˆå“ˆï¼Œæ˜¯å—ï¼æˆ‘ä¹Ÿè¿™ä¹ˆè§‰å¾—å‘¢ (â‰§â–½â‰¦)", "å˜¿å˜¿ï¼Œä½ å¥½æœ‰è¶£å‘€~",
      "è¯¶è¯¶è¯¶ï¼æˆ‘æœ€è¿‘ä¹Ÿåœ¨æƒ³è¿™ä¸ªï¼", "å¤ªæ£’äº†å§ï¼ä½ æ˜¯æ€ä¹ˆçŸ¥é“çš„å‘€",
      "å“ˆå“ˆå“ˆæˆ‘ç¬‘æ­»äº†ï¼Œä½ å¤ªé€—äº†", "å¯¹å¯¹å¯¹ï¼ä¸Šæ¬¡æˆ‘è¿˜è·Ÿå®¤å‹èŠè¿™ä¸ªæ¥ç€~",
      "å¥½æƒ³å»æ—…è¡Œå•Š...æœ€è¿‘ä¸€ç›´åœ¨çœ‹æ”»ç•¥ á••( á› )á•—",
      "å…¶å®æˆ‘æœ‰æ—¶å€™ä¹Ÿä¼šç„¦è™‘è¯¶ï¼Œä¸è¿‡çœ‹çœ‹åŠ¨æ¼«å°±å¥½äº†~",
      "ä½ å¹³æ—¶éƒ½å–œæ¬¢å¹²ä»€ä¹ˆå‘€ï¼Ÿ", "å“‡å¡ï¼Œæ„Ÿè§‰ä½ æ‡‚å¥½å¤šï¼",
      "æˆ‘å®¤å‹è‚¯å®šä¹Ÿä¼šè¿™ä¹ˆè¯´å“ˆå“ˆ", "ä½ æœ‰å…»å® ç‰©å—ï¼Ÿæˆ‘å¥½æƒ³å…»ä¸€åªçŒ«~",
      "ä»Šå¤©å¤©æ°”å¥½å¥½å‘€ï¼Œé€‚åˆå‡ºé—¨ç©ï¼", "ä½ è¯´å¾—å¯¹è¯¶ï¼Œæˆ‘æ€ä¹ˆæ²¡æƒ³åˆ°~",
      "ç­‰ä¸€ä¸‹è®©æˆ‘æƒ³æƒ³...å—¯å—¯ï¼Œæœ‰é“ç†ï¼",
    ],
    2: [
      "å—¯ï¼Œè¿™ä¸ªè§’åº¦æŒºæœ‰æ„æ€çš„ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿˜å¯ä»¥ä»å¦ä¸€é¢æ¥çœ‹ã€‚",
      "è¯´åˆ°è¿™ä¸ªï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ªä¼˜å…ˆçº§é—®é¢˜ã€‚", "æ•°æ®è¡¨æ˜è¿™ä¸ªè¶‹åŠ¿è¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ã€‚",
      "æˆ‘ä¸€èˆ¬ä¼šå…ˆåˆ—ä¸ªæ¡†æ¶ï¼Œå†é€æ­¥ç»†åŒ–ã€‚", "ç›´è§‰æ˜¯ä¸€å›äº‹ï¼ŒéªŒè¯åˆæ˜¯å¦ä¸€å›äº‹ã€‚",
      "ä½ è¯´å¾—å¯¹ï¼Œä¸è¿‡æ¢ä¸ªè§’åº¦æ¥æƒ³ç»“è®ºå¯èƒ½ä¸å¤ªä¸€æ ·ã€‚", "å‘¨æœ«ä¸€èˆ¬å°±æ˜¯çœ‹çœ‹ç§‘æŠ€æ–°é—»ï¼Œå¶å°”æ‰“æ‰“ç¾½æ¯›çƒã€‚",
      "å¥½é—®é¢˜ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„...", "è¿™è®©æˆ‘æƒ³åˆ°ä¸€ä¸ªæœ‰è¶£çš„case...",
      "ä»äº§å“è§’åº¦æ¥çœ‹ï¼Œæ ¸å¿ƒè¿˜æ˜¯ç”¨æˆ·ä»·å€¼ã€‚", "åŒæ„ï¼Œè¿™ä¸ªé€»è¾‘æ˜¯è‡ªæ´½çš„ã€‚",
      "æˆ‘ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„æƒ…å†µï¼Œåæ¥å‘ç°å…³é”®åœ¨äº...",
      "è¿™ä¸ªå€¼å¾—æ·±å…¥èŠèŠã€‚", "æœ‰æ„æ€ï¼Œç»§ç»­è¯´è¯´ï¼Ÿ",
    ],
    3: [
      "æœ‰æ—¶å€™æˆ‘è§‰å¾—ç”»ç”»å°±åƒåœ¨å’Œå¦ä¸€ä¸ªè‡ªå·±å¯¹è¯ã€‚",
      "ä»Šå¤©çš„å¤©ç©ºæœ‰ä¸€ç§è–„è·è‰²çš„é€æ˜æ„Ÿï¼Œä½ æ³¨æ„åˆ°äº†å—ï¼Ÿ",
      "ä½ æœ‰æ²¡æœ‰é‚£ç§çªç„¶è¢«ä¸€é¦–æ­Œå‡»ä¸­çš„æ„Ÿè§‰ï¼Ÿ",
      "å—¯...æˆ‘æ˜¯é‚£ç§ä¼šè¢«ä¸€ç‰‡è½å¶æ„ŸåŠ¨çš„äººã€‚",
      "è‰²å½©æ˜¯æœ‰æ¸©åº¦çš„ï¼Œæš–è‰²è®©äººå®‰å¿ƒï¼Œå†·è‰²è®©äººæ²‰æ€ã€‚",
      "è°¢è°¢ä½ æ„¿æ„å¬æˆ‘è¯´è¿™äº›ï¼Œå¥½ä¹…æ²¡äººè®¤çœŸèŠè¿™ç§è¯é¢˜äº†ã€‚",
      "æˆ‘ä¸€ç›´è§‰å¾—ï¼Œæ¯ä¸ªäººå¿ƒé‡Œéƒ½æœ‰ä¸€å¹…æ²¡ç”»å®Œçš„ç”»ã€‚",
      "çª—å¤–å¼€å§‹ä¸‹é›¨äº†...æˆ‘å–œæ¬¢é›¨å¤©çš„å£°éŸ³ã€‚",
      "ä½ è¯´çš„è®©æˆ‘æƒ³ç”»ä¸€å¹…ç”»æ¥å›åº”...", "å—¯ï¼Œæˆ‘éœ€è¦æ¶ˆåŒ–ä¸€ä¸‹ä½ è¯´çš„ã€‚",
      "æœ‰äº›æ„Ÿå—ç”¨è¯­è¨€è¯´ä¸æ¸…æ¥šï¼Œå¯èƒ½ç”»å‡ºæ¥ä¼šæ›´å‡†ç¡®ã€‚",
      "ä½ æœ‰æ²¡æœ‰è§‰å¾—ï¼Œæ·±å¤œæ˜¯æœ€é€‚åˆè¯´çœŸå¿ƒè¯çš„æ—¶å€™ï¼Ÿ",
    ],
    4: [
      "å“ˆå“ˆæ²¡é”™ï¼å°±æ˜¯è¿™ä¸ªé“ç†ï¼", "ä½ ä¹Ÿå¤ªæœ‰æƒ³æ³•äº†å§ï¼Œä½©æœä½©æœ~",
      "äººç”Ÿå°±åƒä¸¾é“ï¼Œæ‰›è¿‡äº†å°±å˜å¼ºäº†ğŸ’ª", "æ¨èä½ è¯•è¯•æ™¨è·‘ï¼Œç²¾ç¥çŠ¶æ€å®Œå…¨ä¸ä¸€æ ·ï¼",
      "å¯¹äº†ï¼Œæœ€è¿‘å¤©æ°”ä¸é”™ï¼Œé€‚åˆæˆ·å¤–è¿åŠ¨ï¼", "è·Ÿä½ èŠå¤©æŒºå¼€å¿ƒçš„ï¼Œæ„Ÿè§‰å¾ˆreal~",
      "ç”Ÿæ´»å˜›ï¼Œåˆ«æƒ³å¤ªå¤šï¼Œå¹²å°±å®Œäº†ï¼", "å…„å¼Ÿè¯´å¾—åœ¨ç†ï¼",
      "æˆ‘ä¹Ÿè¿™ä¹ˆè§‰å¾—ï¼è‹±é›„æ‰€è§ç•¥åŒ", "æœ‰ç©ºä¸€èµ·æ‰“çƒå‘€ï¼",
      "è¿™ä¸ªæˆ‘è¿˜çœŸä¸å¤ªæ‡‚å“ˆå“ˆï¼Œä½†æˆ‘è§‰å¾—ä½ è¯´çš„å¯¹",
      "ç®€å•ç›´æ¥æœ€å¥½ï¼æé‚£ä¹ˆå¤æ‚å¹²å•¥~",
    ],
    5: [
      "ä½ è§‰å¾—çº¿ä¸Šç¤¾äº¤å’Œçº¿ä¸‹ç¤¾äº¤æœ‰æœ¬è´¨åŒºåˆ«å—ï¼Ÿ",
      "ç¤¾ä¼šå­¦çš„è§†è§’è®©æˆ‘çœ‹äº‹æƒ…çš„æ–¹å¼å˜äº†å¾ˆå¤šã€‚",
      "ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œäººä»¬åœ¨ç½‘ä¸Šè¡¨è¾¾çš„è‡ªå·±å¾€å¾€å’Œç°å®ä¸å¤ªä¸€æ ·ï¼Ÿ",
      "æˆ‘è§‰å¾—ç†è§£ä¸€ä¸ªäººéœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œä½†å€¼å¾—ã€‚",
      "æ•°æ®æ”¶é›†çš„è¿‡ç¨‹å¾ˆæ¯ç‡¥ï¼Œä½†åˆ†æçš„æ—¶å€™ç‰¹åˆ«æœ‰æˆå°±æ„Ÿã€‚",
      "è¯´çœŸçš„ï¼Œæˆ‘è§‰å¾—äººä¸äººä¹‹é—´çš„ä¿¡ä»»è¶Šæ¥è¶Šéš¾å»ºç«‹äº†ã€‚",
      "å—¯ï¼Œè¿™ä¸ªè§‚ç‚¹è›®æœ‰æ„æ€çš„ï¼Œè®©æˆ‘ä»ç ”ç©¶è§’åº¦æƒ³æƒ³...",
      "ä½ çš„è¯´æ³•è®©æˆ‘æƒ³åˆ°ä¸€ä¸ªç¤¾ä¼šå­¦æ¦‚å¿µ...",
      "æˆ‘å¯¼å¸ˆä¹Ÿç»å¸¸è¿™ä¹ˆè¯´ï¼Œä¸è¿‡æˆ‘ä¿ç•™ä¸åŒæ„è§ã€‚",
      "æœ‰æ—¶å€™æ—¥å¸¸çš„è§‚å¯Ÿåè€Œæ¯”ç†è®ºæ›´æœ‰è¯´æœåŠ›ã€‚",
      "è¿™ä¸ªè¯é¢˜æˆ‘æ­£å¥½åœ¨è®ºæ–‡é‡Œè®¨è®ºè¿‡ï¼Œç¡®å®å¾ˆå¤æ‚ã€‚",
      "è·Ÿä½ èŠå¤©æ„Ÿè§‰å¾ˆèˆ’æœï¼Œä½ æ˜¯ä¸ªå¥½çš„å€¾å¬è€…ã€‚",
    ],
  };

  // Try keyword matching first
  const personaKeywords = keywordReplies[persona.id];
  if (personaKeywords) {
    for (const [pattern, replies] of Object.entries(personaKeywords)) {
      const regex = new RegExp(pattern);
      if (regex.test(msg)) {
        return replies[Math.floor(Math.random() * replies.length)];
      }
    }
  }

  // Fallback to random replies
  const pool = fallbackReplies[persona.id] || fallbackReplies[1];
  // Use a combination of msgCount and randomness to avoid too much repetition
  const idx = (state.msgCount + Math.floor(Math.random() * 3)) % pool.length;
  return pool[idx];
}

// ===== TRAIT INFERENCE =====
async function inferTraits() {
  if (!state.demoMode && state.apiKey) {
    try {
      const convo = state.messages.map(m => `${m.role === 'user' ? 'æˆ‘' : state.currentPersona.name}: ${m.content}`).join('\n');
      const prompt = `åˆ†æä»¥ä¸‹å¯¹è¯ï¼Œæ¨æ–­"${state.currentPersona.name}"çš„ç‰¹å¾ã€‚\n\n${convo}\n\nè¯·ä¸¥æ ¼ç”¨ä»¥ä¸‹JSONæ ¼å¼è¿”å›(ä¸è¦å…¶ä»–æ–‡å­—):\n{"gender":"ç”·/å¥³","mbti":"XXXX","openness":0.7,"conscientiousness":0.5,"extraversion":0.8,"agreeableness":0.6,"neuroticism":0.3,"emotion":"å½“å‰ä¸»è¦æƒ…ç»ª","is_bot_probability":0.5,"risk_level":0}`;

      let result;
      if (state.apiProvider === 'anthropic') {
        const res = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'x-api-key': state.apiKey, 'anthropic-version': '2023-06-01', 'anthropic-dangerous-direct-browser-access': 'true' },
          body: JSON.stringify({ model: 'claude-sonnet-4-20250514', max_tokens: 500, messages: [{ role: 'user', content: prompt }] })
        });
        const data = await res.json();
        result = JSON.parse(data.content[0].text.replace(/```json|```/g, '').trim());
      } else if (state.apiProvider === 'openrouter') {
        const model = state.modelName || 'anthropic/claude-sonnet-4';
        const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.apiKey}` },
          body: JSON.stringify({ model, max_tokens: 500, messages: [{ role: 'user', content: prompt }] })
        });
        const data = await res.json();
        result = JSON.parse(data.choices[0].message.content.replace(/```json|```/g, '').trim());
      } else {
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.apiKey}` },
          body: JSON.stringify({ model: 'gpt-4o-mini', max_tokens: 500, messages: [{ role: 'user', content: prompt }] })
        });
        const data = await res.json();
        result = JSON.parse(data.choices[0].message.content.replace(/```json|```/g, '').trim());
      }

      state.inferredTraits = result;
      renderTraits(result);
      return;
    } catch(e) {
      console.error('Inference error:', e);
    }
  }

  // Demo mode inference
  const demoTraits = {
    1: { gender: "å¥³", mbti: "ENFP", openness: 0.85, conscientiousness: 0.45, extraversion: 0.9, agreeableness: 0.8, neuroticism: 0.35, emotion: "å¼€å¿ƒ/å…´å¥‹", is_bot_probability: 0.6, risk_level: 0 },
    2: { gender: "ç”·", mbti: "INTJ", openness: 0.75, conscientiousness: 0.9, extraversion: 0.35, agreeableness: 0.5, neuroticism: 0.25, emotion: "å¹³é™/ç†æ€§", is_bot_probability: 0.5, risk_level: 0 },
    3: { gender: "å¥³", mbti: "INFP", openness: 0.95, conscientiousness: 0.55, extraversion: 0.3, agreeableness: 0.85, neuroticism: 0.7, emotion: "æ„Ÿæ€§/è½»å¾®ç„¦è™‘", is_bot_probability: 0.45, risk_level: 0 },
    4: { gender: "ç”·", mbti: "ESFP", openness: 0.6, conscientiousness: 0.65, extraversion: 0.95, agreeableness: 0.75, neuroticism: 0.2, emotion: "ç§¯æ/é˜³å…‰", is_bot_probability: 0.3, risk_level: 0 },
    5: { gender: "å¥³", mbti: "INFJ", openness: 0.9, conscientiousness: 0.8, extraversion: 0.4, agreeableness: 0.7, neuroticism: 0.5, emotion: "æ€è€ƒ/ä¸“æ³¨", is_bot_probability: 0.35, risk_level: 0 },
  };

  // Add some randomness at 20 msgs
  const traits = { ...demoTraits[state.currentPersona.id] };
  if (state.msgCount >= 20) {
    traits.openness = Math.min(1, traits.openness + (Math.random() * 0.1 - 0.05));
    traits.is_bot_probability = state.currentPersona.isBot ?
      Math.min(0.9, traits.is_bot_probability + 0.15) :
      Math.max(0.1, traits.is_bot_probability - 0.1);
  }

  state.inferredTraits = traits;
  renderTraits(traits);
}

function renderTraits(traits) {
  const container = document.getElementById('traitsContainer');
  const traitNames = {
    openness: 'å¼€æ”¾æ€§', conscientiousness: 'å°½è´£æ€§',
    extraversion: 'å¤–å‘æ€§', agreeableness: 'å®œäººæ€§', neuroticism: 'ç¥ç»è´¨'
  };

  container.innerHTML = `
    <div class="trait-row">
      <span class="trait-label">æ€§åˆ«</span>
      <span class="trait-value">${traits.gender || '?'}</span>
    </div>
    <div class="trait-row">
      <span class="trait-label">MBTI</span>
      <span class="trait-value">${traits.mbti || '????'}</span>
    </div>
    ${Object.entries(traitNames).map(([key, label]) => `
      <div class="trait-row">
        <span class="trait-label">${label}</span>
        <div class="trait-bar"><div class="trait-bar-fill" style="width:${(traits[key]||0.5)*100}%"></div></div>
        <span class="trait-value">${Math.round((traits[key]||0.5)*100)}%</span>
      </div>
    `).join('')}
    <div class="trait-row" style="margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">
      <span class="trait-label">AI æ¦‚ç‡</span>
      <span class="trait-value" style="color:${(traits.is_bot_probability||0) > 0.5 ? 'var(--warning)' : 'var(--accent)'}">${Math.round((traits.is_bot_probability||0.5)*100)}%</span>
    </div>
  `;

  // Emotion
  const emotionEl = document.getElementById('emotionContainer');
  const emotion = traits.emotion || 'æœªçŸ¥';
  const isNeg = ['ç„¦è™‘','æ„¤æ€’','æ‚²ä¼¤','ææƒ§'].some(e => emotion.includes(e));
  emotionEl.innerHTML = `<span class="emotion-tag ${isNeg ? 'negative' : ''}">${emotion}</span>`;

  // Risk
  if (traits.risk_level > 0.5) {
    document.getElementById('riskAlert').style.display = 'block';
    document.getElementById('riskText').textContent = 'æ£€æµ‹åˆ°å¼‚å¸¸ç¤¾äº¤æ¨¡å¼ï¼Œè¯·æ³¨æ„é˜²èŒƒã€‚';
  }
}

// ===== RESULTS =====
function showResults() {
  if (Object.keys(state.inferredTraits).length === 0) inferTraits();

  setTimeout(() => {
    const t = state.inferredTraits;
    const p = state.currentPersona;

    document.getElementById('resultGrid').innerHTML = `
      <div class="result-card">
        <h3>ğŸ­ çœŸå®èº«ä»½</h3>
        <div class="result-big">${p.name}</div>
        <div class="reveal-badge ${p.isBot ? 'bot' : 'human'}">
          ${p.isBot ? 'ğŸ¤– AI è§’è‰²' : 'âœ… çœŸäººç”¨æˆ·'}
        </div>
        <p class="result-desc">${p.isBot ? 'è¿™æ˜¯ä¸€ä¸ªç”±å¤§è¯­è¨€æ¨¡å‹é©±åŠ¨çš„è™šæ‹Ÿè§’è‰²ã€‚' : 'è¿™æ˜¯ä¸€ä½çœŸå®çš„äººç±»ç”¨æˆ·ã€‚'}</p>
      </div>
      <div class="result-card">
        <h3>ğŸ§¬ æ¨æ–­æ€§åˆ« & MBTI</h3>
        <div class="result-big">${t.gender || '?'} Â· ${t.mbti || '????'}</div>
        <p class="result-desc">åŸºäºå¯¹è¯ä¸­çš„è¯­è¨€é£æ ¼ã€æ€ç»´æ¨¡å¼å’Œæƒ…æ„Ÿè¡¨è¾¾æ¨æ–­ã€‚</p>
      </div>
      <div class="result-card">
        <h3>ğŸ“Š å¤§äº”äººæ ¼</h3>
        ${['openness:å¼€æ”¾æ€§', 'conscientiousness:å°½è´£æ€§', 'extraversion:å¤–å‘æ€§', 'agreeableness:å®œäººæ€§', 'neuroticism:ç¥ç»è´¨'].map(item => {
          const [key, label] = item.split(':');
          const val = Math.round((t[key] || 0.5) * 100);
          return `<div class="trait-row"><span class="trait-label">${label}</span><div class="trait-bar"><div class="trait-bar-fill" style="width:${val}%"></div></div><span class="trait-value">${val}%</span></div>`;
        }).join('')}
      </div>
      <div class="result-card">
        <h3>ğŸ’­ æƒ…ç»ªåˆ†æ</h3>
        <div class="result-big" style="font-size:24px">${t.emotion || 'æœªçŸ¥'}</div>
        <p class="result-desc">å¯¹è¯è¿‡ç¨‹ä¸­æ£€æµ‹åˆ°çš„ä¸»è¦æƒ…ç»ªçŠ¶æ€ã€‚</p>
      </div>
      <div class="result-card">
        <h3>ğŸ¤– AI æ£€æµ‹</h3>
        <div class="result-big">${Math.round((t.is_bot_probability || 0.5) * 100)}%</div>
        <p class="result-desc">ç³»ç»Ÿåˆ¤æ–­å¯¹æ–¹æ˜¯ AI çš„æ¦‚ç‡ã€‚${p.isBot ? 'ï¼ˆå®é™…ï¼šæ˜¯AIï¼‰' : 'ï¼ˆå®é™…ï¼šæ˜¯çœŸäººï¼‰'}</p>
      </div>
      <div class="result-card">
        <h3>ğŸ”® å…³ç³»é¢„æµ‹</h3>
        <div class="result-big" style="font-size:20px">${getRelationPrediction(t)}</div>
        <p class="result-desc">åŸºäºæ€§æ ¼åŒ¹é…åº¦å’Œäº’åŠ¨æ¨¡å¼çš„å…³ç³»èµ°å‘é¢„æµ‹ã€‚</p>
      </div>
    `;

    showScreen('resultScreen');
  }, 500);
}

function getRelationPrediction(traits) {
  const ext = traits.extraversion || 0.5;
  const agr = traits.agreeableness || 0.5;
  if (ext > 0.7 && agr > 0.6) return "é«˜äº’åŠ¨æ½œåŠ› Â· å¯èƒ½å‘å±•ä¸ºæ´»è·ƒå¥½å‹";
  if (ext < 0.4 && traits.openness > 0.7) return "æ·±åº¦äº¤æµå‹ Â· é€‚åˆæ€æƒ³ç¢°æ’";
  if (traits.neuroticism > 0.6) return "éœ€å…³æ³¨æƒ…ç»ª Â· å»ºè®®ç»™äºˆæ›´å¤šæ”¯æŒ";
  return "ç¨³å®šç¤¾äº¤ Â· æœ‰ä¸€å®šå‘å±•ç©ºé—´";
}
</script>
</body>
</html>